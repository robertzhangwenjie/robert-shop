---
  kind: pipeline
  type: docker
  name: build
  
  steps:
  - name: build 
    image: node
    failure: ignore
    commands:
    - npm install
    - npm run build


  - name: package docker 
    image: plugins/docker
    settings:
      dockerfile: Dockerfile
      repo: zhangwenjie/robert-shop
      username:
        from_secret: docker_username
      password:
        from_secret: docker_pasword


  - name: dingtalk
    image: lddsb/drone-dingtalk-message
    settings:
      token:
        from_secret: ding_token
      tips_title: "Build Status"
      type: markdown
      message_color: true
      message_pic: true
      sha_link: true
      tpl: drone.tpl
    when:
      status:
      - failure
      - success

    

    
  